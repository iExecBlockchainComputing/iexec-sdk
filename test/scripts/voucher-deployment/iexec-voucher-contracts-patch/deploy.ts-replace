import { writeFile } from 'fs/promises';
import { ethers } from 'hardhat';
import * as voucherHubUtils from '../scripts/voucherHubUtils';
import * as voucherUtils from '../scripts/voucherUtils';

async function main() {
    const iexecPoco = '0x3eca1B216A7DF1C7689aEb259fFB83ADFB894E7f';
    const [admin] = await ethers.getSigners();

    const beacon = await voucherUtils.deployBeaconAndImplementation(admin.address);
    const beaconAddress = await beacon.getAddress();
    console.log(`UpgradeableBeacon: ${beaconAddress}`);
    console.log(`Voucher implementation: ${await beacon.implementation()}`);

    const voucherHub = await voucherHubUtils.deployHub(
        admin.address,
        admin.address,
        iexecPoco,
        beaconAddress,
    );

    const voucherHubAddress = await voucherHub.getAddress();
    console.log(`VoucherHub: ${voucherHubAddress}`);

    await writeFile('.VoucherHub.address', voucherHubAddress);
}

main();
